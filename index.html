<!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>لوحة التحكم المشفرة | AMG Flex</title>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <style>

        :root { --primary: #e50914; --bg: #141414; --surface: #222; --text: #fff; }

        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

        .admin-card { background: var(--surface); padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 90%; max-width: 500px; }

        h2 { text-align: center; margin-top: 0; color: var(--primary); }

        .form-group { margin-bottom: 20px; }

        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #ccc;}

        input, select { width: 100%; padding: 12px; border: 1px solid #444; border-radius: 8px; background: #333; color: white; box-sizing: border-box; font-family: 'Cairo'; font-size: 15px;}

        input:focus, select:focus { outline: none; border-color: var(--primary); }

        button.action-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Cairo'; transition: 0.3s; margin-top: 10px; }

        button.action-btn:hover { background: #b20710; }

        #message { text-align: center; margin-top: 15px; font-weight: bold; }

        .success { color: #4caf50; }

        .error { color: #f44336; }

       

        /* إخفاء فورم الإضافة في البداية */

        #uploadSection { display: none; }

       

        /* نظام التبويبات (Tabs) */

        .tabs { display: flex; gap: 10px; margin-bottom: 25px; }

        .tab-btn { flex: 1; padding: 12px; background: #333; color: #aaa; border: none; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; transition: 0.3s; }

        .tab-btn:hover { background: #444; color: white; }

        .tab-btn.active { background: var(--primary); color: white; }

        .form-section { display: none; }

        .form-section.active { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>

</head>

<body>



    <div class="admin-card">

        <h2>لوحة تحكم الإدارة</h2>



        <div id="loginSection">

            <p style="text-align: center; color: #aaa;">يرجى تسجيل الدخول للوصول لصلاحيات الرفع</p>

            <div class="form-group">

                <input type="email" id="adminEmail" placeholder="البريد الإلكتروني" required>

            </div>

            <div class="form-group">

                <input type="password" id="adminPassword" placeholder="كلمة المرور" required>

            </div>

            <button id="loginBtn" class="action-btn">تسجيل الدخول</button>

        </div>



        <div id="uploadSection">

            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">

                <span style="font-size: 14px; color: #4caf50;">متصل كأدمن ✓</span>

                <button id="logoutBtn" style="background: #555; border: none; color: white; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-family: 'Cairo'; font-size: 12px;">تسجيل الخروج</button>

            </div>

           

            <div class="tabs">

                <button class="tab-btn active" data-target="seriesTab">إضافة مسلسل</button>

                <button class="tab-btn" data-target="episodeTab">إضافة حلقة</button>

            </div>



            <div id="seriesTab" class="form-section active">

                <div class="form-group">

                    <label>اسم المسلسل الجديد:</label>

                    <input type="text" id="newSeriesName" placeholder="مثال: صراع العروش" required>

                </div>

                <div class="form-group">

                    <label>رابط صورة غلاف المسلسل:</label>

                    <input type="url" id="newSeriesImage" placeholder="رابط صورة عامة للمسلسل" required>

                </div>

                <button id="addSeriesBtn" class="action-btn">إنشاء المسلسل</button>

            </div>



            <div id="episodeTab" class="form-section">

                <div class="form-group">

                    <label>اختر المسلسل:</label>

                    <select id="existingSeriesSelect">

                        <option value="">جاري تحميل المسلسلات...</option>

                    </select>

                </div>

                <div class="form-group">

                    <label>عنوان / رقم الحلقة:</label>

                    <input type="text" id="episodeTitle" placeholder="مثال: الحلقة الأولى" required>

                </div>

                <div class="form-group">

                    <label>الرابط المباشر لفيديو الحلقة:</label>

                    <input type="url" id="videoUrl" placeholder="رابط الفيديو (mp4 أو m3u8)" required>

                </div>

                <button id="addEpisodeBtn" class="action-btn">إضافة الحلقة</button>

            </div>

        </div>



        <div id="message"></div>

    </div>



    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";

        import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";



        const firebaseConfig = {

            apiKey: "AIzaSyBwKCkjMX9SZ3Nw2px6q1pf5PZr4UvMcSs",

            authDomain: "moslslat-89ebf.firebaseapp.com",

            projectId: "moslslat-89ebf",

            storageBucket: "moslslat-89ebf.firebasestorage.app",

            messagingSenderId: "80549912513",

            appId: "1:80549912513:web:14b36e5e6e87d3aabb9940",

            measurementId: "G-DJLCLK6HXN",

            databaseURL: "https://moslslat-89ebf-default-rtdb.firebaseio.com"

        };



        const app = initializeApp(firebaseConfig);

        const db = getDatabase(app);

        const auth = getAuth(app);



        const loginSection = document.getElementById('loginSection');

        const uploadSection = document.getElementById('uploadSection');

        const messageEl = document.getElementById('message');

        const existingSeriesSelect = document.getElementById('existingSeriesSelect');



        // --- نظام التبويبات (Tabs) ---

        const tabBtns = document.querySelectorAll('.tab-btn');

        const formSections = document.querySelectorAll('.form-section');



        tabBtns.forEach(btn => {

            btn.addEventListener('click', () => {

                // إزالة التفعيل من الكل

                tabBtns.forEach(b => b.classList.remove('active'));

                formSections.forEach(f => f.classList.remove('active'));

               

                // تفعيل المختار

                btn.classList.add('active');

                document.getElementById(btn.dataset.target).classList.add('active');

                messageEl.textContent = ''; // مسح الرسائل القديمة

            });

        });



        // --- مراقبة حالة تسجيل الدخول ---

        onAuthStateChanged(auth, (user) => {

            if (user) {

                loginSection.style.display = 'none';

                uploadSection.style.display = 'block';

                loadSeriesList(); // تحميل قائمة المسلسلات في القائمة المنسدلة

            } else {

                loginSection.style.display = 'block';

                uploadSection.style.display = 'none';

            }

        });



        // زر تسجيل الدخول

        document.getElementById('loginBtn').addEventListener('click', async () => {

            const email = document.getElementById('adminEmail').value;

            const password = document.getElementById('adminPassword').value;

            try {

                await signInWithEmailAndPassword(auth, email, password);

                messageEl.textContent = "تم تسجيل الدخول بنجاح.";

                messageEl.className = "success";

                setTimeout(() => { messageEl.textContent = ""; }, 3000);

            } catch (error) {

                messageEl.textContent = "خطأ في تسجيل الدخول، تأكد من البيانات.";

                messageEl.className = "error";

            }

        });



        // زر تسجيل الخروج

        document.getElementById('logoutBtn').addEventListener('click', () => {

            signOut(auth);

            messageEl.textContent = "تم تسجيل الخروج.";

            messageEl.className = "success";

        });



        // --- تحميل قائمة المسلسلات للقائمة المنسدلة ---

        function loadSeriesList() {

            onValue(ref(db, 'series'), (snapshot) => {

                existingSeriesSelect.innerHTML = '<option value="">-- اختر المسلسل --</option>';

                if (snapshot.exists()) {

                    const data = snapshot.val();

                    for (const seriesId in data) {

                        const seriesName = data[seriesId].info.name;

                        const option = document.createElement('option');

                        option.value = seriesId;

                        option.textContent = seriesName;

                        existingSeriesSelect.appendChild(option);

                    }

                } else {

                    existingSeriesSelect.innerHTML = '<option value="">لا توجد مسلسلات مضافة بعد</option>';

                }

            });

        }



        // --- دالة إظهار الرسائل ---

        function showMessage(msg, type) {

            messageEl.textContent = msg;

            messageEl.className = type;

            setTimeout(() => { messageEl.textContent = ''; }, 4000);

        }



        // --- إضافة مسلسل جديد (بدون حلقات) ---

        document.getElementById('addSeriesBtn').addEventListener('click', async () => {

            const seriesName = document.getElementById('newSeriesName').value.trim();

            const seriesImage = document.getElementById('newSeriesImage').value.trim();



            if(!seriesName || !seriesImage) {

                showMessage("الرجاء ملء اسم وصورة المسلسل!", "error");

                return;

            }



            try {

                const safeSeriesId = seriesName.replace(/\s+/g, '_');

                await set(ref(db, `series/${safeSeriesId}/info`), {

                    name: seriesName,

                    image: seriesImage

                });

               

                showMessage("تم إنشاء المسلسل بنجاح! يمكنك الآن إضافة حلقات له.", "success");

                document.getElementById('newSeriesName').value = '';

                document.getElementById('newSeriesImage').value = '';

            } catch (error) {

                showMessage("حدث خطأ. تأكد من صلاحياتك.", "error");

            }

        });



        // --- إضافة حلقة لمسلسل موجود ---

        document.getElementById('addEpisodeBtn').addEventListener('click', async () => {

            const seriesId = existingSeriesSelect.value;

            const episodeTitle = document.getElementById('episodeTitle').value.trim();

            const videoUrl = document.getElementById('videoUrl').value.trim();



            if(!seriesId) {

                showMessage("الرجاء اختيار المسلسل أولاً!", "error");

                return;

            }

            if(!episodeTitle || !videoUrl) {

                showMessage("الرجاء ملء بيانات الحلقة!", "error");

                return;

            }



            try {

                const episodesRef = ref(db, `series/${seriesId}/episodes`);

                const newEpisodeRef = push(episodesRef);

                await set(newEpisodeRef, {

                    title: episodeTitle,

                    video: videoUrl

                });



                showMessage("تمت إضافة الحلقة بنجاح!", "success");

                document.getElementById('episodeTitle').value = '';

                document.getElementById('videoUrl').value = '';

            } catch (error) {

                showMessage("حدث خطأ أثناء رفع الحلقة.", "error");

            }

        });



    </script>

</body>

</html>
